# 大きさの変わるキーボードアプリ (Accumulated Data Keyboard)



この[アプリケーション](https://keystroke-research-experiment.streamlit.app/)は、**動的にサイズや位置が変化するソフトウェアキーボード**を用いて、ユーザーの入力行動（キーストロークダイナミクス）データを収集するためのStreamlitアプリです。

研究や実験において、視覚的な負荷（拡大縮小・移動）が入力パフォーマンスに与える影響を分析するために設計されています。

## 特徴

  * **動的な視覚効果**:
      * **呼吸 (Scaling)**: キーボード全体が設定した周期で拡大・縮小を繰り返します。
      * **浮遊 (Moving)**: キーボード全体が画面内を移動します。
  * **高度な設定**:
      * 拡大縮小の速度、最小/最大倍率の調整。
      * 移動の速度、範囲、規則性（指定順序 or ランダム）の調整。
  * **データ収集**:
      * 打鍵時間（Down/Up）、ホールド時間、フライト時間（Down-Down/Up-Down）。
      * 打鍵時のキーボードの状態（スケール、XY座標）。
      * 圧力や指の接地面積（デバイスが対応している場合）。
  * **セッション管理**:
      * ブラウザのリロードを行っても、収集済みのデータは保持されます（`sessionStorage`使用）。

## 動作環境

  * Python 3.x
  * Streamlit

## インストールと実行

1.  **ライブラリのインストール**

    ```bash
    pip install streamlit
    ```

2.  **アプリの実行**
    ソースコードを `app.py` などの名前で保存し、以下のコマンドを実行してください。

    ```bash
    streamlit run app.py
    ```

## 使い方

### 1\. メイン画面の操作

  * **入力欄**: 画面上部のテキストエリアに文字を入力します。
  * **送信 (Next Trial)**: 入力欄をクリアし、試行回数 (Trial) を1つ進めます。**データはリセットされず、保持されます。**
  * **CSVをダウンロード**: これまで記録された全データをCSVファイル (`keyboard_data.csv`) としてダウンロードします。
  * **リセット**: 蓄積された全てのデータを消去し、試行回数を1に戻します。
  * **ステータス表示**: 現在の試行回数 (Trial) と、記録された総打鍵数 (Rec) を表示します。

### 2\. サイドバー設定 (詳細パラメータ)

画面左側のサイドバーで、キーボードの挙動をカスタマイズできます。

#### 拡大機能の設定

  * **拡大機能 ON/OFF**: キーボードの拡大縮小アニメーションの有効/無効を切り替えます。
  * **変化速度 (秒/周期)**: 拡大→縮小→拡大の1サイクルにかかる時間。
  * **最小サイズ**: 縮小時の倍率（0.0〜1.0）。
  * **最大サイズ**: 拡大時の倍率（1.0〜2.0）。

#### 移動機能の設定

  * **移動機能 ON/OFF**: キーボードの移動アニメーションの有効/無効を切り替えます。
  * **移動の速さ (秒/回)**: 次の座標へ移動するのにかかる時間。
  * **移動範囲 (px)**: 中心座標からの最大移動距離。

#### 移動の規則性

  * **移動順序モード**:
      * **規則的 (順序指定)**: 8方向（上、右上、右...）の移動順序をプルダウンで自由に設定できます。
      * **ランダム**: 乱数シードに基づいて、8方向の順序をランダムに決定します。シード値を固定することで、同じランダムパターンを再現可能です。

## 出力データ (CSV) の仕様

ダウンロードされる `keyboard_data.csv` には以下のカラムが含まれます。

| カラム名 | 説明 |
| :--- | :--- |
| **Trial** | 試行回数（「送信」ボタンを押すとカウントアップ） |
| **Key** | 入力されたキーの文字 |
| **DownTime(ms)** | キーを押し込んだ瞬間のタイムスタンプ (Unix Time milliseconds) |
| **UpTime(ms)** | キーを離した瞬間のタイムスタンプ (Unix Time milliseconds) |
| **HoldTime(ms)** | キーを押してから離すまでの時間 (UpTime - DownTime) |
| **DownDown(ms)** | **一つ前のキー**を押し込んでから、今回のキーを押し込むまでの時間 |
| **UpDown(ms)** | **一つ前のキー**を離してから、今回のキーを押し込むまでの時間 |
| **Scale** | キーを押し込んだ瞬間のキーボードの拡大率 |
| **Kb\_X** | キーを押し込んだ瞬間のキーボードのX座標 (BoundingClientRect.x) |
| **Kb\_Y** | キーを押し込んだ瞬間のキーボードのY座標 (BoundingClientRect.y) |
| **Pressure** | 筆圧（対応デバイスのみ。非対応時は0または0.5） |
| **FingerArea** | 指の接地面積（対応デバイスのみ） |

## 注意事項

  * ブラウザのリロードを行うと、**記録データは保持されますが、サイドバーの設定値（スライダーの位置など）は初期値に戻ります。**
  * タッチデバイス（タブレットやスマートフォン）およびマウス操作の両方に対応していますが、Pressure（筆圧）やFingerAreaなどの一部データはハードウェア依存です。

## ライセンス

このプロジェクトは研究・教育目的での使用を想定しています。
