# 大きさの変わるキーボードアプリ (Accumulated Data Keyboard)

このアプリケーションは、動的にサイズや位置が変化するソフトウェアキーボードを用いて、ユーザーの入力行動（キーストロークダイナミクス）データを収集するためのStreamlitアプリです。

研究や実験において、視覚的な負荷（拡大縮小・移動）が入力パフォーマンスに与える影響を分析するために設計されています。

## 特徴

  * **タスク制御**:
      * **Startボタン**: 計測開始ボタンを押すまで入力とアニメーションを無効化し、正確な開始時刻を管理します。
      * **指定文字列入力**: パスワード入力フィールド（`password18`）を採用。入力文字は「●」で隠されますが、背景のガイド文字が入力に合わせて消えていく視覚補助があります。
  * **動的な視覚効果**:
      * **呼吸 (Scaling)**: キーボード全体が設定した周期で拡大・縮小を繰り返します。
      * **浮遊 (Moving)**: キーボード全体が画面内を移動します。
  * **高度な設定**:
      * 拡大縮小の速度、最小/最大倍率の調整。
      * 移動の速度、範囲、規則性（指定順序 or ランダム）の調整。
      * **ランダム移動**: 8方向すべてを1回ずつ通るサイクルをランダムな順序で繰り返すアルゴリズムを実装。
  * **データ収集**:
      * **TimeFromStart**: スタートボタンを押してからの経過時間（ミリ秒）。
      * 打鍵時間（Down/Up）、ホールド時間、フライト時間。
      * 打鍵時のキーボードの状態（スケール、XY座標）。
      * 圧力や指の接地面積（デバイスが対応している場合）。

## 動作環境

  * Python 3.11.13
  * Streamlit

## インストールと実行

1.  **ライブラリのインストール**

    ```bash
    pip install streamlit
    ```

2.  **アプリの実行**
    ソースコードを `app.py` などの名前で保存し、以下のコマンドを実行してください。

    ```bash
    streamlit run app.py
    ```

## 使い方

### 1\. メイン画面の操作

1.  **開始**: 画面中央の「Start」ボタンを押します。
      * キーボードのアニメーションが開始し、入力が可能になります。
      * 計測タイマーがバックグラウンドでスタートします。
2.  **入力**: 指定された文字列「`password18`」を入力します。
      * 入力欄はパスワード形式（●表示）です。
      * 背景の薄いガイド文字は、入力するたびに消えていきます。
3.  **送信 (Next Trial)**: 入力が完了したら「送信」ボタンを押します。
      * 入力欄がクリアされ、試行回数 (Trial) が1つ進みます。
      * **注意**: 「Start」ボタンは再表示されず、そのまま次の試行の計測が始まります。
4.  **CSVをダウンロード**: 記録された全データをCSVファイル (`keyboard_data.csv`) としてダウンロードします。
5.  **リセット**: 蓄積されたデータを消去し、初期状態（Startボタンが表示される状態）に戻します。

### 2\. サイドバー設定 (詳細パラメータ)

画面左側のサイドバーで、キーボードの挙動をカスタマイズできます。**リロードすると設定は初期化されます。**

#### 拡大機能の設定

  * **拡大機能 ON/OFF**: アニメーションの有効/無効。
  * **変化速度**: 拡大縮小の1サイクルにかかる時間。
  * **最小/最大サイズ**: 倍率の設定。

#### 移動機能の設定

  * **移動機能 ON/OFF**: アニメーションの有効/無効。
  * **移動の速さ**: 次の座標へ移動するのにかかる時間。
  * **移動範囲**: 中心からの最大移動距離。

#### 移動の規則性

  * **移動順序モード**:
      * **ランダム (推奨)**: 8方向（上下左右+斜め）を1セットとし、セット内の順序を毎回ランダムに入れ替えてループします（例: `右→上→...` の次は `下→左→...`）。乱数シードを指定可能。
      * **規則的 (順序指定)**: ユーザーが指定した順序で移動を繰り返します。

## 出力データ (CSV) の仕様

| カラム名 | 説明 |
| :--- | :--- |
| **Trial** | 試行回数 |
| **Key** | 入力されたキーの文字 |
| **TimeFromStart(ms)** | **スタートボタン（または前の試行終了）を押してからの経過時間** |
| **DownTime(ms)** | キーを押し込んだ瞬間の絶対時刻 (Unix Time milliseconds) |
| **UpTime(ms)** | キーを離した瞬間の絶対時刻 (Unix Time milliseconds) |
| **HoldTime(ms)** | キーを押してから離すまでの時間 |
| **DownDown(ms)** | 一つ前のキーを押し込んでから、今回のキーを押し込むまでの時間 |
| **UpDown(ms)** | 一つ前のキーを離してから、今回のキーを押し込むまでの時間 |
| **Scale** | 打鍵時のキーボード拡大率 |
| **Kb\_X / Kb\_Y** | 打鍵時のキーボード座標 |
| **Pressure / FingerArea** | 筆圧 / 指の接地面積（対応デバイスのみ） |

## ライセンス

このプロジェクトは研究・教育目的での使用を想定しています。
