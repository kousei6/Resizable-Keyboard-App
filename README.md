# 大きさの変わるキーボードアプリ (Accumulated Data Keyboard)

このアプリケーションは、動的にサイズや位置が変化するソフトウェアキーボードを用いて、ユーザーの入力行動（キーストロークダイナミクス）データを収集するための Streamlit アプリケーションです。

研究や実験において、視覚的な負荷（キーボードの拡大縮小・移動）が入力パフォーマンスに与える影響を分析するために設計されています。

## ファイル構成と違い

このリポジトリには、主に2つのアプリケーションファイルが含まれています。目的に応じて使い分けてください。

| ファイル名 | 用途 | 試行回数 (Trials) | 説明 |
| :--- | :--- | :--- | :--- |
| **`app.py`** | **訓練データ用** | **100回** | 本格的なデータ収集を行うためのメインスクリプトです。 |
| **`app_test.py`** | **テストデータ用** | **25回** | セットアップ時の動作確認や、短時間でのデモ・テストを行うための軽量版です。 |

## 主な特徴

  * **動的な視覚効果（Visual Distractions）**:
      * **呼吸 (Scaling)**: キーボード全体が設定した周期で「拡大・縮小」を繰り返します。
      * **浮遊 (Moving)**: キーボード全体が画面内を移動します。
  * **タスク制御**:
      * **Startボタン**: 計測開始ボタンを押すと全画面モード（または擬似全画面）になり、アニメーションと計測が開始されます。
      * **指定文字列入力**: パスワード入力フィールド（`password18`）を採用。入力文字は「●」で隠されますが、背景のガイド文字が入力に合わせて消えていく視覚補助があります。
  * **高度な設定 (サイドバー)**:
      * 拡大縮小の速度、最小/最大倍率の調整。
      * 移動の速度、範囲、規則性（指定順序 or ランダム）の調整。
      * **ランダム移動**: 8方向すべてを1回ずつ通るサイクルを、ランダムな順序で繰り返すアルゴリズムを実装（シード値固定可能）。
  * **詳細なデータ収集**:
      * 打鍵時間（Down/Up）、ホールド時間、フライト時間。
      * 打鍵時のキーボードの状態（スケール、XY座標）。
      * 圧力や指の接地面積（対応デバイスのみ）。

## 動作環境

  * Python 3.13.9
  * Streamlit

## インストールと実行

1.  **ライブラリのインストール**

    ```bash
    pip install streamlit
    ```

2.  **アプリの実行**
    用途に合わせてコマンドを実行してください。

      * **訓練データ用（100回試行）の場合:**

        ```bash
        streamlit run app.py
        ```

      * **テストデータ用（25回試行）の場合:**

        ```bash
        streamlit run app_test.py
        ```

## 使い方

### 1\. メイン画面の操作

1.  **開始**: 画面中央の「Start」ボタンを押します。
      * ブラウザが全画面表示になり、キーボードのアニメーションが開始します。
2.  **入力**: 指定された文字列「`password18`」を入力します。
      * キーボード上のキーをクリック/タップして入力してください。
      * 10文字入力すると、自動的にデータが保存され、次の試行へ進む準備が行われます（少し待つと自動で次へ進みます）。
3.  **送信 (Next Trial)**: 手動で進む場合は「送信」ボタンを押します（基本は自動遷移）。
4.  **完了とダウンロード**: 規定の回数（`app.py`は100回、`app_test.py`は25回）が終了するとアラートが表示されます。「CSVをダウンロード」ボタンを押して `keyboard_data.csv` を保存してください。
5.  **リセット**: 「リセット」ボタンを押すと、蓄積されたデータが消去され初期状態に戻ります。

### 2\. サイドバー設定 (詳細パラメータ)

画面左側のサイドバーで挙動をカスタマイズできます。**設定を変更（リロード）すると、進行中のデータはリセットされるためご注意ください。**

#### 拡大機能の設定

  * **拡大機能 ON/OFF**: アニメーションの有効/無効。
  * **変化速度**: 拡大縮小の1サイクルにかかる時間。
  * **最小/最大サイズ**: 倍率の設定。

#### 移動機能の設定

  * **移動機能 ON/OFF**: アニメーションの有効/無効。
  * **移動の速さ**: 次の座標へ移動するのにかかる時間。
  * **移動範囲**: 中心からの最大移動距離(px)。

#### 移動の規則性

  * **ランダム (推奨)**: 8方向（上下左右+斜め）を1セットとし、セット内の順序を毎回ランダムに入れ替えてループします。
  * **規則的**: ユーザーが指定した順序で移動を繰り返します。

## 出力データ (CSV) の仕様

| カラム名 | 説明 |
| :--- | :--- |
| **Trial** | 試行回数 (1〜Max) |
| **Key** | 入力されたキーの文字 |
| **TimeFromStart(ms)** | タスク開始（Startボタン押下）からの経過時間 |
| **DownTime(ms)** | キーを押し込んだ瞬間の絶対時刻 (Unix Time ms) |
| **UpTime(ms)** | キーを離した瞬間の絶対時刻 (Unix Time ms) |
| **HoldTime(ms)** | キーを押してから離すまでの時間 (UpTime - DownTime) |
| **DownDown(ms)** | 一つ前のキーを押し込んでから、今回のキーを押し込むまでの時間 |
| **UpDown(ms)** | 一つ前のキーを離してから、今回のキーを押し込むまでの時間 |
| **Scale** | 打鍵時のキーボード拡大率 (CSS transform scale) |
| **Kb\_X / Kb\_Y** | 打鍵時のキーボード座標 (BoundingClientRect) |
| **Pressure / FingerArea** | 筆圧 / 指の接地面積（対応デバイスのみ記録、PCでは0になることが多い） |

## アプリURL
[app.py](https://github.com/kousei6/Resizable-Keyboard-App/blob/main/app.py)

[app_test.py](https://github.com/kousei6/Resizable-Keyboard-App/blob/main/app_test.py)
